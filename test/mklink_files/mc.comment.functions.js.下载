var comment_nowpage=1;var comment_selfonly=0;var comment_quote=0;var isCommitSetup={};isCommitSetup[0]=false;setTimeout(function(){$(window).scroll()},1);$(document).ready(function(){setTimeout(function(){$(window).scroll()},1);});$(window).scroll(function(){if($(".common-comment-block.lazy").length>0)
{if(!isCommitSetup[0]&&$(".common-comment-block.lazy").text().length==0&&$(window).scrollTop()>$(".common-comment-block.lazy").offset().top-$(window).height())
{isCommitSetup[0]=true;var data={};data['comment_type']=comment_type;data['comment_container']=comment_container;var strData=JSON.stringify(data);var comment_obj=$.ajax({url:'//'+strStaticUrl+"/frame/comment/CommentFrame/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{},complete:function()
{$(".common-comment-block").html(comment_obj.responseText);},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});}}});$(document).on("click",".comment-row .comment-tools .comment-reply",function(){var tools_frame=$(this).parents(".comment-tools");var username=tools_frame.prevAll(".comment-row-username,.comment-reply-row-username").find("a:eq(0)").text();if(tools_frame.next().hasClass("comment-reply-input-block"))
{tools_frame.next().remove();}
else
{var id=tools_frame.children(".comment-id").val();if(!parseInt(id))
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][101],'err');return false;}
$(".comment-reply-input-block").remove();tools_frame.after("<div class=\"comment-reply-input-block\"><textarea class=\"form-control comment-reply-text\" rows=\"5\" placeholder=\""+sprintf(PublicLangData['comment']['reply']['holder'],'',username)+"\"></textarea><input class=\"btn btn-success btn-sm comment-reply-submit\" value=\""+PublicLangData['comment']['reply']['button']+"\" type=\"button\" /></div>");var reply_frame=tools_frame.next();reply_frame.children(".comment-reply-submit").bind("click",function(){var _this=$(this);if(_this.hasClass("disabled"))return;var text=reply_frame.children(".comment-reply-text").val().trim();var len=removeHtmlTag(text).length
if(len.length<3)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['submit']['empty'],'tip');return false;}
if(len.length>5000)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['submit']['full'],'tip');return false;}
text=text.replace(/\r\n/g,"<br/>")
text=text.replace(/\n/g,"<br/>");var data={};data['todo']="submit";data['type']=comment_type;data['channel']=comment_channel;data['container']=comment_container;data['reply']=id;data['text']=text;var strData=JSON.stringify(data);var comment_submit_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{_this.removeClass("btn-success").addClass("btn-secondary").addClass("disabled").val(PublicLangData['loading']+"..");},complete:function()
{if(comment_submit_obj.responseText)
{var obj=$.parseJSON(comment_submit_obj.responseText);if(obj.state==0)
{if(_this.parents(".comment-reply-row").length>0)
{var floor_frame=_this.parents(".comment-reply-floor");var parentid=floor_frame.prev().children(".comment-id").val();}
else
{var block=_this.parents(".comment-reply-input-block");if(block.next().length==0)
{block.after("<div class=\"comment-reply-floor\"></div>");}
var floor_frame=block.next();var parentid=block.prev().children(".comment-id").val();}
tools_frame.next().remove();get_reply_comment(floor_frame,parentid,1,false);}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}
_this.addClass("btn-success").removeClass("btn-secondary").removeClass("disabled").val(PublicLangData['comment']['submit']['button']);},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});});}});$(document).on("click",".comment-row .comment-tools .comment-quote",function(){comment_quote=$(this).parents(".comment-tools").children(".comment-id").val();var name=$(this).parent().parent().parent().children(".comment-row-username").text();var floor=$(this).parent().parent().parent().parent().children(".comment-row-userinfo").text();var ReplyText="[&nbsp;"+PublicLangData['comment']['quote']['button']+"&nbsp;"+name+"&nbsp;("+floor+")&nbsp;<span class=\"close\"><i class=\"fas fa-times\"></i></span>&nbsp;]";$("#comment-quote").html(ReplyText);$("#comment-quote .close").bind("click",function(){comment_quote=0;$("#comment-quote").html("");$(".comment-row .comment-tools .comment-quote").parent().show();});$(".comment-row .comment-tools .comment-quote").parent().show();$(this).parent().hide();$("html,body").animate({scrollTop:$(".comment-title").offset().top-200},450);});$(document).on("click",".comment-channel-list li a",function(){if($(this).hasClass('active'))return;$(".comment-channel-list li a").removeClass("active");$(this).addClass("active");var channel=$(this).attr("data-channel-type").trim();switch(channel)
{case'1':comment_channel='1';$.cookie('topicChannel',1,{expires:36500,path:'/'});break;case'2':comment_channel='2';$.cookie('topicChannel',2,{expires:36500,path:'/'});break;case'3':comment_channel='3';$.cookie('topicChannel',3,{expires:36500,path:'/'});break;default:return;}
get_comment(comment_container,comment_type);});$(document).on("click","#comment-submit",function(){if($(this).hasClass("disabled"))return;var text=editor.getContent().trim();var len=removeHtmlTag(text).length
if(len.length<3)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['submit']['empty'],'tip');return false;}
if(len.length>5000)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['submit']['full'],'tip');return false;}
var data={};data['todo']="submit";data['type']=comment_type;data['channel']=comment_channel;data['container']=comment_container;data['quote']=comment_quote;data['text']=text;var strData=JSON.stringify(data);var comment_submit_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{$("#comment-submit").removeClass("btn-success").addClass("btn-secondary").addClass("disabled").val(PublicLangData['loading']+"..");},complete:function()
{if(comment_submit_obj.responseText)
{var obj=$.parseJSON(comment_submit_obj.responseText);if(obj.state==0)
{comment_nowpage=1;comment_quote=0;$("#comment-quote").html("");editor.setContent('<p></p>');get_comment(comment_container,comment_type);}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}
$("#comment-submit").addClass("btn-success").removeClass("btn-secondary").removeClass("disabled").val(PublicLangData['comment']['submit']['button']);},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});});$(document).on("click",".comment-row .comment-tools .comment-attitude",function(){var _this=$(this).parents(".comment-tools").children(".comment-attitude-result");var data={};data['todo']="attitude";data['attitude_type']=$(this).attr("data-type");data['attitude_tid']=$(this).parents(".comment-tools").children(".comment-id").val();if(!data['attitude_type']||!data['attitude_tid'])return false;var strData=JSON.stringify(data);var comment_attitude_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{},complete:function()
{if(comment_attitude_obj.responseText)
{var obj=$.parseJSON(comment_attitude_obj.responseText);if(obj.state==0)
{if(_this.find("a[data-type='"+data['attitude_type']+"']").hasClass("colourful"))
{_this.find("a[data-type='"+data['attitude_type']+"']").removeClass("colourful");_this.find("a[data-type='"+data['attitude_type']+"']").children("span").text(parseInt(_this.find("a[data-type='"+data['attitude_type']+"']").children("span").text())-1);if(parseInt(_this.find("a[data-type='"+data['attitude_type']+"']").children("span").text())==0)
{_this.find("a[data-type='"+data['attitude_type']+"']").parent().hide();}}
else
{var has=_this.find(".comment-attitude.colourful");if(has.length>0)
{has.removeClass("colourful");has.children("span").text(parseInt(has.children("span").text())-1);}
_this.find("a").each(function(){if(parseInt($(this).children("span").text())==0)
{$(this).parent().hide();}});var tmp=_this.find("a[data-type='"+data['attitude_type']+"']");tmp.parent().show();tmp.addClass("colourful").children("span").text(parseInt(tmp.children("span").text())+1);}}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});});$(document).on("click",".comment-top",function(){swal({title:PublicLangData['comment']['top']['title'],text:PublicLangData['comment']['top']['content'],type:'question',confirmButtonText:PublicLangData['yes'],cancelButtonText:PublicLangData['no'],preConfirm:()=>{var data={};data['todo']="top";data['type']=comment_type;data['channel']=comment_channel;data['container']=comment_container;data['top_id']=$(this).parents(".comment-tools").children(".comment-id").val();var strData=JSON.stringify(data);return new Promise(function(resolve,reject)
{var comment_top_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{swal.showLoading();},complete:function()
{swal.hideLoading();swal.close();if(comment_top_obj.responseText)
{var obj=$.parseJSON(comment_top_obj.responseText);if(obj.state==0)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['top']['complete'],'ok');get_comment(comment_container,comment_type);}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});});},allowOutsideClick:()=>!Swal.isLoading(),allowEscapeKey:()=>!Swal.isLoading(),showCancelButton:()=>!Swal.isLoading(),}).then((result)=>{if(result.value)
{swal.hideLoading();}});});$(document).on("click",".comment-delete",function(){var _this=$(this).parents(".comment-reply-row").length>0?$(this).parents(".comment-reply-row"):$(this).parents(".comment-row")
swal({title:PublicLangData['comment']['delete']['title'],text:PublicLangData['comment']['delete']['content'],type:'question',confirmButtonText:PublicLangData['yes'],cancelButtonText:PublicLangData['no'],preConfirm:()=>{var data={};data['todo']="delete";data['delete_id']=$(this).parents(".comment-tools").children(".comment-id").val();var strData=JSON.stringify(data);return new Promise(function(resolve,reject)
{var comment_delete_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{swal.showLoading();},complete:function()
{swal.hideLoading();swal.close();if(comment_delete_obj.responseText)
{var obj=$.parseJSON(comment_delete_obj.responseText);if(obj.state==0)
{_this.slideUp();common_msg(PublicLangData['remind'],PublicLangData['comment']['delete']['complete'],'ok');}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});});},allowOutsideClick:()=>!Swal.isLoading(),allowEscapeKey:()=>!Swal.isLoading(),showCancelButton:()=>!Swal.isLoading(),}).then((result)=>{if(result.value)
{swal.hideLoading();}});});$(document).on("click",".comment-report",function(){swal({title:PublicLangData['comment']['report']['title'],text:PublicLangData['comment']['report']['content'],type:'question',input:'text',confirmButtonText:PublicLangData['submit'],cancelButtonText:PublicLangData['cancel'],preConfirm:()=>{},allowOutsideClick:()=>!Swal.isLoading(),allowEscapeKey:()=>!Swal.isLoading(),showCancelButton:()=>!Swal.isLoading(),}).then((result)=>{if(result.dismiss)return;if(result.value)
{var data={};data['todo']="report";data['report_tid']=$(this).parents(".comment-tools").children(".comment-id").val();data['report_reason']=result.value;var strData=JSON.stringify(data);var comment_report_obj=$.ajax({url:"//"+strStaticUrl+"/action/doComment/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{swal.showLoading();},complete:function()
{swal.hideLoading();swal.close();if(comment_report_obj.responseText)
{var obj=$.parseJSON(comment_report_obj.responseText);if(obj.state==0)
{common_msg(PublicLangData['remind'],PublicLangData['comment']['report']['complete'],'ok');}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});}
else
{common_msg(PublicLangData['remind'],PublicLangData['comment']['report']['empty'],'err');}});});$(document).on("click","#comment-selfonly",function(){if(comment_selfonly==0)
{$("#comment-selfonly").html('<i class="fas fa-eye-slash"></i>'+PublicLangData['comment']['selfonly']['off']);comment_selfonly=1;}
else
{$("#comment-selfonly").html('<i class="fas fa-eye"></i>'+PublicLangData['comment']['selfonly']['open']);comment_selfonly=0;}
comment_nowpage=1;get_comment(comment_container,comment_type);});$(document).on("click",".comment-floor .common-pages[data-name='comment-list'] .page-link",function(){comment_nowpage=$(this).attr("data-page");get_comment(comment_container,comment_type);});$(document).on("click",".comment-floor .common-pages[data-name='comment-reply-list'] .page-link",function(){var page=$(this).attr("data-page");get_reply_comment($(this).parent().parent().parent(),$(this).parent().parent().parent().prev().children(".comment-id").val(),page,false);});function get_comment(DoID,Type)
{if(!DoID||!Type)return false;var data={};data['type']=Type;data['channel']=comment_channel;data['doid']=DoID;data['page']=comment_nowpage;data['selfonly']=comment_selfonly;var strData=JSON.stringify(data);var get_comment_htmlobj=$.ajax({url:"//"+strStaticUrl+"/frame/comment/CommentRow/",async:true,cache:false,data:{data:strData},type:"post",xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{$(".comment-row").css("opacity",.5);},complete:function()
{var html='';var page='';if(get_comment_htmlobj.responseText)
{var obj=$.parseJSON(get_comment_htmlobj.responseText);if(obj.state==0)
{if(obj.data.is_empty==1)
{if(Type=='center')
{html+='<li class="none">'+PublicLangData['comment']['empty']['center']+'</li>'}
else
{html+='<li class="none">'+PublicLangData['comment']['empty']['common']+'</li>'}}
else
{if(typeof(obj.data.page)!="undefined"&&obj.data.page)
{page=get_page_html(obj.data.page);}
obj.data.row.forEach(function(value,i){var skip_class='';var avatar_frame='';if(value.skip)
{skip_class=' skip';}
html+="<li class=\"comment-row"+skip_class+"\"><div class=\"comment-row-userinfo\">";if(typeof(value.user.avatar.frame)!="undefined"&&value.user.avatar.frame.length>0)
{avatar_frame=" style=\"background-image:url(/static/public/images/user/frame/"+value.user.avatar.frame+"/frame_58x.png)\"";}
if(value.user.id>0)
{html+="<div class=\"frame\""+avatar_frame+" data-uid=\""+value.user.id+"\"><a rel=\"nofollow\" title=\""+value.user.name+"\" target=\"_blank\" href=\"//center.mcmod.cn/"+value.user.id+"/\"><img alt=\""+value.user.name+"\" src=\""+value.user.avatar.img+"\" width=\"100\" height=\"100\"/></a></div>"+value.floor;}
else
{html+="<img title=\""+value.user.name+"\" alt=\""+value.user.name+"\" src=\""+value.user.avatar.img+"\" width=\"100\" height=\"100\"/>"+value.floor;}
html+="</div><div class=\"comment-row-content\"><ul class=\"comment-row-username\">";if(value.user.id>0)
{html+="<li><a rel=\"nofollow\" target=\"_blank\" href=\"//center.mcmod.cn/"+value.user.id+"/\" data-uid=\""+value.user.id+"\">"+value.user.name+"</a></li>";const date=new Date();if((comment_type=='class'||comment_type=='item')&&date.getMonth()+1==4&&date.getDate()==1&&(typeof(value.is_owner)!="undefined"&&value.is_owner))
{html+="<li><a rel=\"nofollow\" href=\"//www.bilibili.com/opus/1050737498155646993\" target=\"_blank\" title=\""+PublicLangData['comment']['suffix']['mod_manager']+" (Lv."+value.user.lv+")\" class=\"common-user-lv manager\">"+PublicLangData['comment']['suffix']['mod_manager']+"</a></li>";}
else
{switch(value.user.sp)
{case 1:html+="<li><a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\""+PublicLangData['comment']['suffix']['post_author']+" (Lv."+value.user.lv+")\" class=\"common-user-lv post-author\">"+PublicLangData['comment']['suffix']['post_author']+"</a></li>";break;case 2:html+="<li><a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\""+PublicLangData['comment']['suffix']['mod_developer']+" (Lv."+value.user.lv+")\" class=\"common-user-lv developer\">"+PublicLangData['comment']['suffix']['mod_developer']+"</a></li>";break;case 3:html+="<li><a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\""+PublicLangData['comment']['suffix']['mod_manager']+" (Lv."+value.user.lv+")\" class=\"common-user-lv manager\">"+PublicLangData['comment']['suffix']['mod_manager']+"</a></li>";break;case 4:html+="<li><a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\""+PublicLangData['comment']['suffix']['mod_admin']+" (Lv."+value.user.lv+")\" class=\"common-user-lv admin\">"+PublicLangData['comment']['suffix']['mod_admin']+"</a></li>";break;default:html+="<li><a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\"Lv."+value.user.lv+"\" class=\"common-user-lv lv-"+value.user.lv+"\">Lv."+value.user.lv+"</a></li>";break;}}}
else
{html+=value.user.name;}
if(typeof(value.user.wap)!="undefined"&&value.user.wap)html+="<li><a href=\"javascript:void(0);\" title=\""+PublicLangData['comment']['suffix']['phone']+"\" class=\"phone\"></a></li>";html+="</ul>";if(value.skip)
{html+="<blockquote class=\"comment-skip-block\">"+sprintf(PublicLangData['comment']['skip'],value.skip)+"</blockquote>";}
if(typeof(value.quote)!="undefined"&&typeof(value.quote.state)!="undefined")
{var quote_content='';switch(value.quote.state)
{case 1:quote_content="<span class=\"text-muted\">***"+PublicLangData['comment']['delete']['state']['self']+"***</span>";break;case 2:quote_content="<span class=\"text-muted\">***"+PublicLangData['comment']['delete']['state']['admin']+"***</span>";break;case 3:quote_content="<span class=\"text-muted\">***"+PublicLangData['comment']['delete']['state']['notfound']+"***</span>";break;default:quote_content=value.quote.content;break;}
html+="<blockquote class=\"comment-quote-block\">("+sprintf(PublicLangData['comment']['floor'],value.quote.floor)+") "+value.quote.name+": "+quote_content+"</blockquote>";}
html+="<div class=\"comment-row-text\">";html+="<div class=\"comment-row-text-content common-text font14\">"+value.content+"</div>";html+="</div>";var tools='';tools+="<li title=\""+value.time.range+"\" class=\"comment-reply-row-time\">"+value.time.source+"</li>";if(obj.data.is_login>0)tools+="<li><a class=\"comment-reply\" href=\"javascript:void(0);\"><i class=\"fa fa-reply\"></i>"+PublicLangData['comment']['reply']['button']+"</a></li>";if(obj.data.is_login>1&&$(".comment-editor .comment-close").length==0)tools+="<li><a class=\"comment-quote\" href=\"javascript:void(0);\"><i class=\"fas fa-quote-left\"></i>"+PublicLangData['comment']['quote']['button']+"</a></li>";if(typeof(value.attitude)!="undefined")
{var attitude_result='';var attitude_list='';Object.keys(PublicLangData.comment.attitude).forEach(function(val,i){var num=0
var icon=get_attitude_icon(val);var style=' style="display:none;"';if(value.attitude[val])
{num=value.attitude[val];style='';}
var colourful='';if(value.attitude.use==val)
{colourful=' colourful';}
attitude_result+="<li title=\""+PublicLangData['comment']['attitude'][val]+"\""+style+"><a href=\"javascript:void(0);\" class=\"comment-attitude "+val+colourful+"\" data-type=\""+val+"\">"+icon+"<span>"+num+"</span></a></li>";if(!(typeof(value.is_owner)!="undefined"&&value.is_owner))
{attitude_list+="<li><a title=\""+PublicLangData['comment']['attitude'][val]+"\" href=\"javascript:void(0);\" class=\"comment-attitude "+val+"\" data-type=\""+val+"\">"+icon+"</a></li>";}});if(attitude_result)tools+="<ol class=\"comment-attitude-result\">"+attitude_result+"</ol>";if(obj.data.is_login>0)tools+='<span class="comment-delimiter"></span>';if(obj.data.is_login>0&&attitude_list)tools+="<li title=\""+PublicLangData['comment']['attitude_button']+"\" class=\"comment-attitude-list\"><a class=\"comment-attitude-list-button\" href=\"javascript:void(0);\"><i class=\"fas fa-smile-o\"></i><i class=\"fas fa-caret-up\"></i></a><div class=\"comment-attitude-list-hover\"><ul>"+attitude_list+"</ul></div></li>";}
if(typeof(value.top)!="undefined")
{if(value.top==0)
{tools+="<li><a class=\"comment-top\" href=\"javascript:void(0);\"><i class=\"fas fa-hand-o-up\"></i>"+PublicLangData['comment']['top']['button']['confirm']+"</a></li>";}
else
{tools+="<li><a class=\"comment-top\" href=\"javascript:void(0);\"><i class=\"fas fa-hand-o-up\"></i>"+PublicLangData['comment']['top']['button']['cancel']+"</a></li>";}}
if(typeof(value.access)!="undefined"&&value.access==1)
{tools+="<li><a class=\"comment-delete\" href=\"javascript:void(0);\"><i class=\"fas fa-trash-alt\"></i>"+PublicLangData['comment']['delete']['button']+"</a></li>";}
if(typeof(value.report)!="undefined"&&value.report==1)
{tools+="<li><a class=\"comment-report\" href=\"javascript:void(0);\"><i class=\"fas fa-flag\"></i>"+PublicLangData['comment']['report']['button']+"</a></li>";}
if(tools)html+="<ul class=\"comment-tools\"><input class=\"comment-id\" name=\"comment-id\" value=\""+value.id+"\" type=\"hidden\" />"+tools+"</ul>";if(value.reply_count>0)html+="<div class=\"comment-reply-floor\"></div>";html+="</div></div></li>";});}
$(".common-comment-block .comment-floor").html(page+html+page);comment_limit();reset_sticker_size();comment_row_resize();get_user_card($(".comment-floor .comment-row-userinfo .frame:not(.poped), .comment-floor .comment-row-username li a:not(.common-user-lv,.phone,.poped)"));function comment_limit()
{switch(comment_channel)
{case'1':if(typeof(comment_user_id)!="undefined"&&comment_user_id==0)
{$(".comment-editor-area").hide();$(".comment-limit").show();$(".comment-limit").html(sprintf(PublicLangData['comment']['channel']['unlogin'][1],"<a target=\"_blank\" href=\"//www.mcmod.cn/login/\">","</a>"));}
else
{$(".comment-editor-area").show();$(".comment-limit").hide();}
break;case'2':if(typeof(comment_user_wordnum)!="undefined"&&typeof(comment_user_editnum)!="undefined"&&(comment_user_wordnum<2000||comment_user_editnum<70))
{$(".comment-editor-area").hide();$(".comment-limit").show();$(".comment-limit").html(PublicLangData['comment']['channel']['unlogin'][2]);}
else
{$(".comment-editor-area").show();$(".comment-limit").hide();}
break;case'3':if(typeof(comment_user_id)!="undefined"&&comment_user_id>0)
{$(".comment-editor-area").hide();$(".comment-limit").show();$(".comment-limit").html(PublicLangData['comment']['channel']['unlogin'][3]);}
else
{$(".comment-editor-area").show();$(".comment-limit").hide();}
break;default:return;}}
function reset_sticker_size()
{$(".comment-row-text-content img").each(function(){var src=$(this).attr("src");if(src.search(/.*\/ueditor\/dialogs\/emotion\/images\/.*/ig)>-1)
{$(this).removeAttr("width").removeAttr("height");}
$(this).load(function(){comment_row_resize();});});}
function comment_row_resize()
{$(".comment-row-text-content").each(function(){if($(this).height()>300)
{if(!$(this).parent().next().hasClass("fold"))
{$(this).parent().next().before("<a class=\"fold text-muted\"><i class=\"fas fa-chevron-down\"></i>"+PublicLangData['comment']['fold']['down']+"</a>");}
$(this).next(".fold").show();}
else
{$(this).next(".fold").hide();}});}
$(window).resize(function(){comment_row_resize();});$(".comment-reply-floor").each(function(){var _comment_reply_this=$(this);var _comment_reply_id=_comment_reply_this.prev().children(".comment-id").val();isCommitSetup[_comment_reply_id]=false;$(window).scroll(function(){if(!isCommitSetup[_comment_reply_id]&&_comment_reply_this.text().length==0&&$(window).scrollTop()>_comment_reply_this.offset().top-$(window).height())
{isCommitSetup[_comment_reply_id]=true;get_reply_comment(_comment_reply_this,_comment_reply_id,1,true);}});});try
{$(".comment-floor [data-toggle='tooltip']").tooltip({animation:false});common_imgview($(".comment-floor .common-text"));}catch(e){}}
else
{common_msg(PublicLangData['warning']['inform']['title'],PublicLangData['warning']['inform'][obj.state],'err');}}
$(".comment-row").css("opacity",'');}});}
function get_reply_comment(_this,replyID,page,showLoadImg)
{if(!_this||!replyID||!page)return false;var data={};data['replyID']=replyID;data['page']=page;var strData=JSON.stringify(data);var comment_reply_obj=$.ajax({url:'//'+strStaticUrl+"/frame/comment/CommentReply/",async:true,type:"post",data:{data:strData},xhrFields:{withCredentials:true},crossDomain:true,beforeSend:function()
{if(showLoadImg)_this.html("<img alt=\"loading\" src=\"//www.mcmod.cn/static/public/images/loading-colourful.gif\" width=\"32\" height=\"32\" />");},complete:function()
{var html='';var page='';if(comment_reply_obj.responseText)
{var obj=$.parseJSON(comment_reply_obj.responseText);if(obj.state==0)
{if(typeof(obj.data.row)!="undefined"&&obj.data.row)
{if(typeof(obj.data.page)!="undefined"&&obj.data.page)
{page=get_page_html(obj.data.page);}
obj.data.row.forEach(function(value,i){html+="<div class=\"comment-reply-row\">"+"<div class=\"comment-reply-row-avatar\" data-uid=\""+value.user.id+"\">";if(value.user.id>0)
{html+="<a rel=\"nofollow\" title=\""+value.user.name+"\" target=\"_blank\" href=\"//center.mcmod.cn/"+value.user.id+"/\"><img alt=\""+value.user.name+"\" src=\""+value.user.avatar.img+"\" /></a>";}
else
{html+="<img title=\""+value.user.name+"\" alt=\""+value.user.name+"\" src=\""+value.user.avatar.img+"\" />";}
html+="</div><div class=\"comment-reply-row-username\">";if(value.user.id>0)
{html+="<a rel=\"nofollow\" target=\"_blank\" href=\"//center.mcmod.cn/"+value.user.id+"/\" data-uid=\""+value.user.id+"\">"+value.user.name+"</a>"+"<a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.user.id+"/#/rank/\" target=\"_blank\" title=\"Lv."+value.user.lv+"\" class=\"common-user-lv lv-"+value.user.lv+"\">Lv."+value.user.lv+"</a>";}
else
{html+=value.user.name;}
var reply_talk='';if(typeof(value.reply_user)!="undefined"&&value.reply_user)
{reply_talk=sprintf(PublicLangData['comment']['reply']['holder'],"<a rel=\"nofollow\" href=\"//center.mcmod.cn/"+value.reply_user.id+"/\" target=\"_blank\">",value.reply_user.name+"</a>");}
var tools='';tools+="<li title=\""+value.time.range+"\" class=\"comment-reply-row-time\">"+value.time.source+"</li>";if(obj.data.is_login>0)tools+="<li><a class=\"comment-reply\" href=\"javascript:void(0);\"><i class=\"fa fa-reply\"></i>"+PublicLangData['comment']['reply']['button']+"</a></li>";if(typeof(value.attitude)!="undefined")
{var attitude_result='';var attitude_list='';Object.keys(PublicLangData.comment.attitude).forEach(function(val,i){var num=0
var icon=get_attitude_icon(val);var style=' style="display:none;"';if(value.attitude[val])
{num=value.attitude[val];style='';}
var colourful='';if(value.attitude.use==val)
{colourful=' colourful';}
attitude_result+="<li title=\""+PublicLangData['comment']['attitude'][val]+"\""+style+"><a href=\"javascript:void(0);\" class=\"comment-attitude "+val+colourful+"\" data-type=\""+val+"\">"+icon+"<span>"+num+"</span></a></li>";if(!(typeof(value.is_owner)!="undefined"&&value.is_owner))
{attitude_list+="<li><a title=\""+PublicLangData['comment']['attitude'][val]+"\" href=\"javascript:void(0);\" class=\"comment-attitude "+val+"\" data-type=\""+val+"\">"+icon+"</a></li>";}});if(attitude_result)tools+="<ol class=\"comment-attitude-result\">"+attitude_result+"</ol>";if(obj.data.is_login>0)tools+='<span class="comment-delimiter"></span>';if(obj.data.is_login>0&&attitude_list)tools+="<li title=\""+PublicLangData['comment']['attitude_button']+"\" class=\"comment-attitude-list\"><a class=\"comment-attitude-list-button\" href=\"javascript:void(0);\"><i class=\"fas fa-smile-o\"></i><i class=\"fas fa-caret-up\"></i></a><div class=\"comment-attitude-list-hover\"><ul>"+attitude_list+"</ul></div></li>";}
if(typeof(value.access)!="undefined"&&value.access==1)
{tools+="<li><a class=\"comment-delete\" href=\"javascript:void(0);\"><i class=\"fas fa-trash-alt\"></i>"+PublicLangData['comment']['delete']['button']+"</a></li>";}
if(typeof(value.report)!="undefined"&&value.report==1)
{tools+="<li><a class=\"comment-report\" href=\"javascript:void(0);\"><i class=\"fas fa-flag\"></i>"+PublicLangData['comment']['report']['button']+"</a></li>";}
if(tools)tools="<ul class=\"comment-tools\"><input class=\"comment-id\" name=\"comment-id\" value=\""+value.id+"\" type=\"hidden\" />"+tools+"</ul>";html+="</div><div class=\"comment-reply-row-text-content common-text font14\">"+reply_talk+value.content+"</div>"+tools+"</div>";});_this.html(html+page);get_user_card($(".comment-reply-floor .comment-reply-row-avatar:not(.poped), .comment-reply-floor .comment-reply-row-username a:not(.common-user-lv,.poped)"));}}}},error:function(a,b)
{connect_error(b);},timeout:timmeLimit});}
function get_page_html(obj)
{var page='';if(typeof(obj.home)!="undefined"&&obj.home)
{page+='<li class="page-item"><a class="page-link" href="javascript:void(0);" data-page="1">'+PublicLangData['pages']['home']+'</a></li>';}
if(typeof(obj.prev)!="undefined"&&obj.prev)
{page+='<li class="page-item"><a class="page-link" href="javascript:void(0);" data-page="'+obj.prev+'">'+PublicLangData['pages']['prev']+'</a></li>';}
if(typeof(obj.list)!="undefined"&&obj.list)
{obj.list.forEach(function(value,i){if(obj.now_page==value)
{page+='<li class="page-item active"><a class="page-link" href="javascript:void(0);">'+value+'</a></li>';}
else
{page+='<li class="page-item"><a class="page-link" href="javascript:void(0);" data-page="'+value+'">'+value+'</a></li>';}});}
if(typeof(obj.next)!="undefined"&&obj.next)
{page+='<li class="page-item"><a class="page-link" href="javascript:void(0);" data-page="'+obj.next+'">'+PublicLangData['pages']['next']+'</a></li>';}
if(typeof(obj.end)!="undefined"&&obj.end)
{page+='<li class="page-item"><a class="page-link" href="javascript:void(0);" data-page="'+obj.end+'">'+PublicLangData['pages']['end']+'</a></li>';}
page+='<span>'+sprintf(obj.count_lang,obj.now_page,obj.total_page,obj.total_row)+'</span>';page="<ul class=\"pagination common-pages\" data-name=\""+obj.name+"\">"+page+"</ul>";return page;}
function get_attitude_icon(val)
{icon='';switch(val)
{case'up':icon='<i class="fas fa-thumbs-up"></i>';break;case'grintears':icon='<i class="fas fa-grin-tears"></i>';break;case'heart':icon='<i class="fas fa-heart"></i>';break;case'flushed':icon='<i class="fas fa-flushed"></i>';break;case'down':icon='<i class="fas fa-thumbs-down"></i>';break;case'lemon':icon='<i class="fas fa-lemon"></i>';break;case'horsehead':icon='<i class="fas fa-horse-head"><sup>?</sup></i>';break;case'heartbroken':icon='<i class="fas fa-heart-broken"></i>';break;case'angry':icon='<i class="fas fa-angry"></i>';break;case'tired':icon='<i class="fas fa-tired"></i>';break;case'snowflake':icon='<i class="fas fa-snowflake"></i>';break;case'handshake':icon='<i class="fas fa-handshake"></i>';break;}
return icon;}
$(document).on("click",".comment-row .fold",function(){var obj=$(this).prev(".comment-row-text");if($(this).text()==PublicLangData['comment']['fold']['down'])
{obj.css("max-height","initial");$(this).html("<i class=\"fas fa-chevron-up\"></i>"+PublicLangData['comment']['fold']['up']);}
else
{obj.css("max-height","");$(this).html("<i class=\"fas fa-chevron-down\"></i>"+PublicLangData['comment']['fold']['down']);}});